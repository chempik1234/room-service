# Логика работы сервиса

## Сущности

Сущностей всего 2:

1. Комната - UUID
2. Пользователи - ID, предоставляемый вами

Комната содержит пользователей и данные сессии. Благодаря возможности
добавлять свои данные, семантически они могут являться почти чем угодно, например:

1. Данными о матче в игре
2. Рисунками в виде полигонов или списков линий
3. Ячейками в онлайн-таблице

## Функции

1. Создать комнату (ID генерируется нами)
2. Удалить комнату (по ID, если такой в БД есть, иначе ошибка)
3. Зайти в комнату (присоединиться, если ещё не, идемпотентно)
4. Выйти из комнаты (если ещё не, идемпотентно)
5. Редактировать данные - задать, обновить (для список/словарей), удалить (если пользователь есть в комнате, иначе
   ошибка)

| Функция              | Идемпотентность | Пояснение                                        | Условия                                             |
|----------------------|-----------------|--------------------------------------------------|-----------------------------------------------------|
| Создать комнату      |                 | ID генерируется нами                             |                                                     |
| Удалить комнату      |                 |                                                  | если ID в БД есть и вы хозяин комнаты, иначе ошибка |      
| Зайти в комнату      | Да              | Добавить пользователя в список посетителей       |                                                     |
| Выйти из комнаты     | Да              |                                                  |
| Редактировать данные | TODO: понять    | задать, обновить (для списков/словарей), удалить | если пользователь есть в комнате, иначе ошибка      |

## Процесс работы

Процесс работы может быть организован в виде одиночных команд, Query-запросов
или потока обмена командами и их результатами, которые можно рассылать пользователям
в комнате.

Итого мы имеем:

1. Stream - ваш бэкенд подключается (и отключается) в любой момент и обменивается командами с сервисом
   комнат.
2. Одиночные команды - то же самое в формате самостоятельных запросов с получением полного
   snapshot комнаты (или информации о её удалении).

## Причины возможных проблем

1. Что если двое редактируют одно и то же? Нам нужна либо надёжная NoSQL БД,
   либо in-memory структура, обвешанная mutex.